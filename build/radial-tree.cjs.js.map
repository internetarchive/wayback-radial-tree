{"version":3,"file":"radial-tree.cjs.js","sources":["../src/js/processing/surt.js","../src/js/processing/hierarchy.js","../src/js/processing/timemap.js","../src/js/rendering/container.js","../src/js/rendering/tree.js","../src/js/rendering/year-button.js","../src/js/rendering/year-button-container.js","../src/js/index.js"],"sourcesContent":["/**\n * get SURT (Sort-friendly URI Reordering Transform)\n * https://github.com/internetarchive/surt\n * and convert it back to URL\n *\n * [!] current implementation works only with host part of SURT\n *\n * @param surt\n * @returns {String}\n */\nexport function surtToUrl (surt) {\n  if (!surt) {\n    return surt;\n  }\n  // drop last ')'\n  surt = surt.slice(0, surt.length - 1);\n  return surt.split(',').reverse().join('.');\n}\n","import { surtToUrl } from './surt';\n\n/**\n * @private\n *\n * traverse in depth from parent by path\n *\n * @param parent is current node\n * @param path is array of names\n * @returns {*}\n */\nfunction buildHierarchInDepth (parent, path) {\n  if (!path || path.length === 0) {\n    return;\n  }\n\n  const [name, ...rest] = path;\n\n  if (!name) {\n    return;\n  }\n\n  let nextParent;\n\n  if (parent.children) {\n    nextParent = parent.children.filter(c => c.name === name)[0];\n  } else {\n    parent.children = [];\n  }\n\n  if (!nextParent) {\n    nextParent = {\n      name\n    };\n    parent.children.push(nextParent);\n  }\n\n  buildHierarchInDepth(nextParent, rest);\n}\n\n/**\n * build hierarchical structure:\n *\n * {name: '{name}': children: [...]}\n *\n * which is valid for d3.hierarchy\n * from timemap site data\n *\n * @param fields -\n * @param data - source\n * @param targetField - which field we use to create hierarchy\n *\n * @returns {Object}\n */\nexport function buildHierarchy (fields, data, { targetField }) {\n  return data.reduce((res, row) => {\n    const value = fields.getValueByName(row, targetField);\n    const [host, ...path] = value.split('/');\n    res.name = surtToUrl(host);\n    buildHierarchInDepth(res, path);\n    return res;\n  }, {});\n}\n","import _ from 'lodash';\n\n/**\n * extract fields from time map data\n *\n */\nexport class Fields {\n  constructor (data) {\n    this.fields = data[0];\n    this.getIndexByName = _.memoize(this.getIndexByName);\n  }\n\n  /**\n   * get index of field by name\n   *\n   * @param name\n   */\n  getIndexByName (name) {\n    return this.fields.indexOf(name);\n  }\n\n  /**\n   * get value of field in row by name\n   *\n   * @param row\n   * @param name\n   * @returns {*}\n   */\n  getValueByName (row, name) {\n    return row[this.getIndexByName(name)];\n  }\n}\n\n/**\n * get all sorted years from grouped time map data\n *\n * @param data time map data\n * @returns {Array} years\n */\nexport function extractYearsFromGroupedTimeMap (data) {\n  if (!data) {\n    return data;\n  }\n\n  return Object.keys(data).sort();\n}\n\n/**\n * data processing pipeline for time map:\n *\n * [[<keys>], [values]....[values]]\n *\n * - group by one field\n * - dedup by another field\n * - order by one field\n *\n * @param data timemap format\n * @param groupBy\n * @param dedupBy\n * @param orderBy\n *\n * @return processed data\n */\nexport function processTimeMap (data, { groupBy, dedupBy, orderBy } = {}) {\n  if (!data) {\n    return data;\n  }\n  const fields = new Fields(data);\n  const res = data\n    .slice(1)\n    .reduce((result, row) => {\n      const oneGroup = result[fields.getValueByName(row, groupBy)] || {};\n\n      // don't add if we already have it\n      if (!oneGroup[fields.getValueByName(row, dedupBy)]) {\n        oneGroup[fields.getValueByName(row, dedupBy)] = row;\n      }\n\n      result[fields.getValueByName(row, groupBy)] = oneGroup;\n      return result;\n    }, {});\n\n  // if someday we would get bad performance here\n  // we could make insertion with sorthing above\n  return _(res)\n    .mapValues(value => Object.values(value))\n    .mapValues(value => _.sortBy(value, fields.getIndexByName(orderBy)))\n    .value();\n}\n","export function renderContainer () {\n  const content = document.createElement('div');\n  content.setAttribute('class', 'rt-content');\n  const divBtn = document.createElement('div');\n  divBtn.setAttribute('class', 'div-btn');\n\n  const sequence = document.createElement('p');\n  sequence.setAttribute('class', 'sequence');\n  const chart = document.createElement('div');\n  chart.setAttribute('id', 'chart');\n  content.appendChild(divBtn);\n  content.appendChild(sequence);\n  content.appendChild(chart);\n  content.style.display = 'block';\n  return content;\n}\n","import * as d3 from 'd3';\n\nconst arc = d3.arc()\n  .startAngle(d => d.x0)\n  .endAngle(d => d.x1)\n  .innerRadius(d => Math.sqrt(d.y0))\n  .outerRadius(d => Math.sqrt(d.y1));\n\nconst colors = d3.scaleOrdinal(d3.schemePaired);\n\n/**\n * Render d3.hierarchy from passed hierarchical data\n *\n * @param element\n * @param vis\n * @param radius\n * @param baseURL\n * @param currentYear\n * @param data\n */\nexport function createVisualization (element, vis, radius, baseURL, currentYear, data) {\n  const partition = d3.partition()\n    .size([2 * Math.PI, radius * radius]);\n\n  // append 'root' we will exclude it on rendering\n  const root = d3.hierarchy({ children: [data] })\n    .sum(d => !d.children)\n    .sort((a, b) => b.value - a.value);\n\n  const nodes = partition(root).descendants();\n\n  vis.selectAll('path')\n    .data(nodes)\n    .enter()\n    .append('a')\n    .attr('xlink:href', currentUrl)\n    .on('touchstart', touchStart)\n    .append('svg:path')\n    .attr('display', d => d.depth ? null : 'none')\n    .attr('d', arc)\n    .attr('fill-rule', 'evenodd')\n    .style('fill', d => colors((d.children ? d : d.parent).data.name))\n    .style('opacity', 1)\n    .style('cursor', 'pointer')\n    .on('mouseover', mouseover);\n\n  d3.select('#d3_container')\n    .on('mouseleave', mouseleave);\n\n  /** on mobile devices, touching the RadialTree prevents the ``click``\n   *  event and shows the URL like on ``mouseover`` event. Users can click\n   *  on the URL to visit the target page */\n  function touchStart (e, d) {\n    e.preventDefault();\n    e.stopPropagation();\n    mouseover(d);\n    return false;\n  }\n\n  function currentUrl (d) {\n    // TODO skip the reverse to speed it up.\n    const anc = d.ancestors().reverse();\n    let url = '';\n    for (let i = 1; i < anc.length; i++) {\n      if (anc[i].data.name === 'end') {\n        break;\n      }\n      url = url + '/' + anc[i].data.name;\n    }\n    return `${baseURL}/web/${currentYear}0630${url}`;\n  }\n\n  function mouseover (e, d) {\n    const sequenceArray = d.ancestors().reverse();\n    sequenceArray.shift();\n    const url = currentUrl(d);\n    updateBreadcrumbs(sequenceArray, url);\n    d3.selectAll('path').style('opacity', 0.3);\n\n    vis.selectAll('path')\n      .filter(node => sequenceArray.indexOf(node) >= 0)\n      .style('opacity', 1);\n  }\n\n  function mouseleave () {\n    element.querySelector('.sequence').innerHTML = '';\n\n    d3.selectAll('path')\n      .on('mouseover', null);\n\n    d3.selectAll('path')\n      .transition()\n      .style('opacity', 1)\n      .on('end', function () {\n        d3.select(this).on('mouseover', mouseover);\n      });\n  }\n\n  function updateBreadcrumbs (nodeArray, url) {\n    let text = '';\n    const symb = document.createElement('span');\n    symb.setAttribute('class', 'symb');\n    symb.innerHTML = '/';\n    for (let i = 0; i < nodeArray.length; i++) {\n      if (i === 0) {\n        text = ' ' + nodeArray[i].data.name;\n      } else {\n        text = text + symb.innerHTML + nodeArray[i].data.name;\n      }\n    }\n    text = decodeURIComponent(text);\n    element.querySelector('.sequence').innerHTML = `<a href=\"${url}\">${text}</a>`;\n  }\n}\n","export function renderYearButton (year) {\n  const btn = document.createElement('button');\n  btn.setAttribute('class', 'year-btn');\n  btn.setAttribute('id', year);\n  btn.innerHTML = year;\n  return btn;\n}\n\nexport function getYearByBtn (btn) {\n  return btn.id;\n}\n\nexport function getButtonByYear (container, year) {\n  return container.ownerDocument.getElementById(year);\n}\n","import { renderYearButton, getYearByBtn } from './year-button';\n\nexport function renderYearButtons (element, allYears, onYearSelect) {\n  const divBtn = element.querySelector('.div-btn');\n  divBtn.onclick = (evt) => onYearSelect(getYearByBtn(evt.target));\n\n  if (!element.querySelector('.year-btn')) {\n    allYears.forEach(year =>\n      divBtn.appendChild(renderYearButton(year))\n    );\n  }\n}\n","import * as d3 from 'd3';\nimport {\n  buildHierarchy, extractYearsFromGroupedTimeMap, Fields, processTimeMap\n} from './processing';\nimport {\n  createVisualization, getButtonByYear, renderContainer, renderYearButtons\n} from './rendering';\n\n/**\n * Radial Tree Library\n *\n * @param {DOMElement} element\n * @param {Array} cdxData: decoded CDX Query data retrieved by:\n ``/web/timemap/json?url=example.com/&fl=timestamp:4,urlkey&matchType=prefix\n &filter=statuscode:200&filter=mimetype:text/html&collapse=urlkey\n &collapse=timestamp:4&limit=100000``.\n * @param {Object} [options]\n * Option baseURL defines the target Wayback Machine server.\n *\n */\nexport function RadialTree (element, cdxData, options = {}) {\n  const baseURL = options.baseURL || 'https://web.archive.org';\n\n  // render\n  const container = renderContainer();\n  element.appendChild(container);\n\n  const fields = new Fields(cdxData);\n  const urlsByYear = processTimeMap(cdxData, {\n    groupBy: 'timestamp:4',\n    dedupBy: 'urlkey',\n    orderBy: 'urlkey'\n  });\n  const years = extractYearsFromGroupedTimeMap(urlsByYear);\n\n  renderYearButtons(element, years, selectYear);\n\n  // highlight the 2nd last year if available, else hightlight the last.\n  // necessary because the last year may not have much data.\n  // const lastButOneYear = allYears[allYears.length - 2] || allYears[0];\n  const selectedBtn = years[years.length - 2] || years[0];\n  selectYear(selectedBtn);\n\n  function selectYear (year) {\n    // hide active button\n    if (element.querySelector('.active-btn')) {\n      element.querySelector('.active-btn').classList.remove('active-btn');\n    }\n\n    // show active button\n    const btn = getButtonByYear(element, year);\n    if (btn) {\n      btn.classList.add('active-btn');\n    }\n\n    renderChart(element, year);\n  }\n\n  function renderChart (element, currentYear) {\n    element.querySelector('.sequence').innerHTML = '';\n    element.querySelector('#chart').innerHTML = '';\n\n    const width = element.querySelector('#chart').offsetWidth;\n    const height = width;\n    const radius = Math.min(width, height) / 2;\n\n    const vis = d3.select('#chart')\n      .append('svg:svg')\n      .attr('width', width)\n      .attr('height', height)\n      .append('svg:g')\n      .attr('id', 'd3_container')\n      .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n\n    vis.append('svg:circle')\n      .attr('r', radius)\n      .style('opacity', 0);\n\n    const urls = urlsByYear[currentYear];\n    const hierarchy = buildHierarchy(fields, urls, {\n      targetField: 'urlkey'\n    });\n\n    createVisualization(element, vis, radius, baseURL, currentYear, hierarchy);\n  }\n}\n"],"names":["surtToUrl","surt","slice","length","split","reverse","join","buildHierarchInDepth","parent","path","_path","_toArray","name","rest","nextParent","children","filter","c","push","buildHierarchy","fields","data","_ref","targetField","reduce","res","row","value","getValueByName","_value$split","_value$split2","host","Fields","_classCallCheck","getIndexByName","_","memoize","_createClass","key","indexOf","extractYearsFromGroupedTimeMap","Object","keys","sort","processTimeMap","arguments","undefined","groupBy","dedupBy","orderBy","result","oneGroup","mapValues","values","sortBy","renderContainer","content","document","createElement","setAttribute","divBtn","sequence","chart","appendChild","style","display","arc","d3","startAngle","d","x0","endAngle","x1","innerRadius","Math","sqrt","y0","outerRadius","y1","colors","scaleOrdinal","schemePaired","createVisualization","element","vis","radius","baseURL","currentYear","partition","size","PI","root","hierarchy","sum","a","b","nodes","descendants","selectAll","enter","append","attr","currentUrl","on","touchStart","depth","mouseover","select","mouseleave","e","preventDefault","stopPropagation","anc","ancestors","url","i","concat","sequenceArray","shift","updateBreadcrumbs","node","querySelector","innerHTML","transition","nodeArray","text","symb","decodeURIComponent","renderYearButton","year","btn","getYearByBtn","id","getButtonByYear","container","ownerDocument","getElementById","renderYearButtons","allYears","onYearSelect","onclick","evt","target","forEach","RadialTree","cdxData","options","urlsByYear","years","selectYear","selectedBtn","classList","remove","add","renderChart","width","offsetWidth","height","min","urls"],"mappings":"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"}