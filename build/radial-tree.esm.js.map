{"version":3,"file":"radial-tree.esm.js","sources":["../src/js/processing/surt.js","../src/js/processing/hierarchy.js","../src/js/processing/timemap.js","../src/js/rendering/container.js","../src/js/rendering/tree.js","../src/js/rendering/year-button.js","../src/js/rendering/year-button-container.js","../src/js/index.js"],"sourcesContent":["/**\n * get SURT (Sort-friendly URI Reordering Transform)\n * https://github.com/internetarchive/surt\n * and convert it back to URL\n *\n * [!] current implementation works only with host part of SURT\n *\n * @param surt\n * @returns {String}\n */\nexport function surtToUrl (surt) {\n  if (!surt) {\n    return surt;\n  }\n  // drop last ')'\n  return surt.slice(0, surt.length - 1).split(',').reverse().join('.');\n}\n","import { surtToUrl } from './surt';\n\n/**\n * @private\n *\n * traverse in depth from parent by path\n *\n * @param parent is current node\n * @param path is array of names\n * @returns {*}\n */\nfunction buildHierarchInDepth (parent, path) {\n  if (!path || path.length === 0) {\n    return;\n  }\n\n  let currentParent = parent;\n  let currentPath = path;\n\n  while (currentPath.length > 0) {\n    const [name, ...rest] = currentPath;\n\n    if (!name) {\n      return;\n    }\n\n    // Cache the children reference to avoid repeated lookups\n    if (!currentParent.children) {\n      currentParent.children = [];\n    }\n\n    // Find the child node or create a new one\n    let nextParent = currentParent.children.find(child => child.name === name);\n\n    if (!nextParent) {\n      nextParent = { name };\n      currentParent.children.push(nextParent);\n    }\n\n    // Move down the hierarchy\n    currentParent = nextParent;\n    currentPath = rest;\n  }\n}\n\n/**\n * build hierarchical structure:\n *\n * {name: '{name}': children: [...]}\n *\n * which is valid for d3.hierarchy\n * from timemap site data\n *\n * @param fields -\n * @param data - source\n * @param targetField - which field we use to create hierarchy\n *\n * @returns {Object}\n */\nexport function buildHierarchy (fields, data, { targetField }) {\n  return data.reduce((res, row) => {\n    const [host, ...path] = fields.getValueByName(row, targetField).split('/');\n    res.name = surtToUrl(host);\n    buildHierarchInDepth(res, path);\n    return res;\n  }, {});\n}\n","/**\n * extract fields from time map data\n */\nexport class Fields {\n  constructor (data) {\n    this.fields = data[0];\n    this._indexCache = new Map();\n  }\n\n  /**\n   * get index of field by name\n   *\n   * @param name\n   */\n  getIndexByName (name) {\n    if (this._indexCache.has(name)) {\n      return this._indexCache.get(name);\n    }\n\n    const index = this.fields.indexOf(name);\n    this._indexCache.set(name, index);\n    return index;\n  }\n\n  /**\n   * get value of field in row by name\n   *\n   * @param row\n   * @param name\n   * @returns {*}\n   */\n  getValueByName (row, name) {\n    return row[this.getIndexByName(name)];\n  }\n}\n\n/**\n * get all sorted years from grouped time map data\n *\n * @param data time map data\n * @returns {Array} years\n */\nexport function extractYearsFromGroupedTimeMap (data) {\n  if (!data) {\n    return data;\n  }\n\n  return Object.keys(data).sort();\n}\n\n/**\n * data processing pipeline for time map:\n *\n * [[<keys>], [values]....[values]]\n *\n * - group by one field\n * - dedup by another field\n * - order by one field\n *\n * @param data timemap format\n * @param groupBy\n * @param dedupBy\n * @param orderBy\n *\n * @return processed data\n */\nexport function processTimeMap (data, { groupBy, dedupBy, orderBy } = {}) {\n  if (!data) {\n    return data;\n  }\n\n  const fields = new Fields(data);\n  const groupByIndex = fields.getIndexByName(groupBy);\n  const dedupByIndex = fields.getIndexByName(dedupBy);\n  const orderByIndex = fields.getIndexByName(orderBy);\n\n  // Use an object to group and deduplicate rows\n  const groupedData = data.slice(1).reduce((result, row) => {\n    const groupKey = row[groupByIndex];\n    const dedupKey = row[dedupByIndex];\n\n    // Initialize group if not exists\n    if (!result[groupKey]) {\n      result[groupKey] = {};\n    }\n\n    // Add row if it hasn't been deduplicated already\n    if (!result[groupKey][dedupKey]) {\n      result[groupKey][dedupKey] = row;\n    }\n\n    return result;\n  }, {});\n\n  // Convert groups to arrays and sort by orderBy field\n  return Object.keys(groupedData).reduce((acc, key) => {\n    const values = Object.values(groupedData[key]);\n\n    acc[key] = values.sort((a, b) => a[orderByIndex] - b[orderByIndex]);\n    return acc;\n  }, {});\n}\n","export function renderContainer () {\n  const content = document.createElement('div');\n  content.setAttribute('class', 'rt-content');\n  const divBtn = document.createElement('div');\n  divBtn.setAttribute('class', 'div-btn');\n\n  const sequence = document.createElement('p');\n  sequence.setAttribute('class', 'sequence');\n  const chart = document.createElement('div');\n  chart.setAttribute('id', 'chart');\n  content.appendChild(divBtn);\n  content.appendChild(sequence);\n  content.appendChild(chart);\n  content.style.display = 'block';\n  return content;\n}\n","import * as d3 from 'd3';\n\nconst arc = d3.arc()\n  .startAngle(d => d.x0)\n  .endAngle(d => d.x1)\n  .innerRadius(d => Math.sqrt(d.y0))\n  .outerRadius(d => Math.sqrt(d.y1));\n\nconst colors = d3.scaleOrdinal(d3.schemePaired);\n\n/**\n * Render d3.hierarchy from passed hierarchical data\n *\n * @param element\n * @param vis\n * @param radius\n * @param baseURL\n * @param currentYear\n * @param data\n */\nexport function createVisualization (element, vis, radius, baseURL, currentYear, data) {\n  const partition = d3.partition().size([2 * Math.PI, radius * radius]);\n\n  // append 'root' we will exclude it on rendering\n  const root = d3.hierarchy({ children: [data] })\n    .sum(d => !d.children)\n    .sort((a, b) => b.value - a.value);\n\n  const nodes = partition(root).descendants();\n  const sequenceEl = element.querySelector('.sequence');\n\n  vis.selectAll('path')\n    .data(nodes)\n    .enter()\n    .append('a')\n    .attr('xlink:href', currentUrl)\n    .on('touchstart', touchStart)\n    .append('svg:path')\n    .attr('display', d => d.depth ? null : 'none')\n    .attr('d', arc)\n    .attr('fill-rule', 'evenodd')\n    .style('fill', d => colors((d.children ? d : d.parent).data.name))\n    .style('opacity', 1)\n    .style('cursor', 'pointer')\n    .on('mouseover', mouseover);\n\n  d3.select('#d3_container')\n    .on('mouseleave', mouseleave);\n\n  /** on mobile devices, touching the RadialTree prevents the ``click``\n   *  event and shows the URL like on ``mouseover`` event. Users can click\n   *  on the URL to visit the target page */\n  function touchStart (e, d) {\n    e.preventDefault();\n    e.stopPropagation();\n    mouseover(d);\n    return false;\n  }\n\n  function currentUrl (d) {\n    // TODO skip the reverse to speed it up.\n    const anc = d.ancestors().reverse();\n    let url = anc.slice(1).map(node => node.data.name).join('/');\n    return `${baseURL}/web/${currentYear}0630/${url}`;\n  }\n\n  function mouseover (e, d) {\n    const sequenceArray = d.ancestors().reverse();\n    sequenceArray.shift();\n    const url = currentUrl(d);\n    updateBreadcrumbs(sequenceArray, url);\n    d3.selectAll('path').style('opacity', 0.3);\n\n    vis.selectAll('path')\n      .filter(node => sequenceArray.indexOf(node) >= 0)\n      .style('opacity', 1);\n  }\n\n  function mouseleave () {\n    sequenceEl.innerHTML = '';\n\n    d3.selectAll('path')\n      .on('mouseover', null);\n\n    d3.selectAll('path')\n      .transition()\n      .style('opacity', 1)\n      .on('end', function () {\n        d3.select(this).on('mouseover', mouseover);\n      });\n  }\n\n  function updateBreadcrumbs(nodeArray, url) {\n    const text = nodeArray.map(node => node.data.name).join('/');\n    sequenceEl.innerHTML = `<a href=\"${url}\">${decodeURIComponent(text)}</a>`;\n  }\n}\n","export function renderYearButton (year) {\n  const btn = document.createElement('button');\n  btn.className = 'year-btn';\n  btn.id = year;\n  btn.textContent = year;\n  return btn;\n}\n\nexport function getYearByBtn (btn) {\n  return btn.id;\n}\n\nexport function getButtonByYear (container, year) {\n  return container.ownerDocument.getElementById(year);\n}\n","import { renderYearButton, getYearByBtn } from './year-button';\n\nexport function renderYearButtons (element, allYears, onYearSelect) {\n  const divBtn = element.querySelector('.div-btn');\n  divBtn.onclick = (evt) => onYearSelect(getYearByBtn(evt.target));\n\n  if (!element.querySelector('.year-btn')) {\n    allYears.forEach(year =>\n      divBtn.appendChild(renderYearButton(year))\n    );\n  }\n}\n","import * as d3 from 'd3';\nimport {\n  buildHierarchy, extractYearsFromGroupedTimeMap, Fields, processTimeMap\n} from './processing';\nimport {\n  createVisualization, getButtonByYear, renderContainer, renderYearButtons\n} from './rendering';\n\n/**\n * Radial Tree Library\n *\n * @param {DOMElement} element\n * @param {Array} cdxData: decoded CDX Query data retrieved by:\n ``/web/timemap/json?url=example.com/&fl=timestamp:4,urlkey&matchType=prefix\n &filter=statuscode:200&filter=mimetype:text/html&collapse=urlkey\n &collapse=timestamp:4&limit=100000``.\n * @param {Object} [options]\n * Option baseURL defines the target Wayback Machine server.\n *\n */\nexport function RadialTree (element, cdxData, options = {}) {\n  const baseURL = options.baseURL || 'https://web.archive.org';\n\n  // render\n  const container = renderContainer();\n  element.appendChild(container);\n\n  const fields = new Fields(cdxData);\n  const urlsByYear = processTimeMap(cdxData, {\n    groupBy: 'timestamp:4',\n    dedupBy: 'urlkey',\n    orderBy: 'urlkey'\n  });\n  const years = extractYearsFromGroupedTimeMap(urlsByYear);\n\n  renderYearButtons(element, years, selectYear);\n\n  // highlight the 2nd last year if available, else hightlight the last.\n  // necessary because the last year may not have much data.\n  // const lastButOneYear = allYears[allYears.length - 2] || allYears[0];\n  const selectedBtn = years[years.length - 2] || years[0];\n  selectYear(selectedBtn);\n\n  function selectYear (year) {\n    // hide active button\n    if (element.querySelector('.active-btn')) {\n      element.querySelector('.active-btn').classList.remove('active-btn');\n    }\n\n    // show active button\n    const btn = getButtonByYear(element, year);\n    if (btn) {\n      btn.classList.add('active-btn');\n    }\n\n    renderChart(element, year);\n  }\n\n  function renderChart (element, currentYear) {\n    element.querySelector('.sequence').innerHTML = '';\n    element.querySelector('#chart').innerHTML = '';\n\n    const width = element.querySelector('#chart').offsetWidth;\n    const height = width;\n    const radius = width / 2;\n\n    const vis = d3.select('#chart')\n      .append('svg:svg')\n      .attr('width', width)\n      .attr('height', height)\n      .append('svg:g')\n      .attr('id', 'd3_container')\n      .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n\n    vis.append('svg:circle')\n      .attr('r', radius)\n      .style('opacity', 0);\n\n    const urls = urlsByYear[currentYear];\n    const hierarchy = buildHierarchy(fields, urls, {\n      targetField: 'urlkey'\n    });\n\n    createVisualization(element, vis, radius, baseURL, currentYear, hierarchy);\n  }\n}\n"],"names":["surtToUrl","surt","slice","length","split","reverse","join","buildHierarchInDepth","parent","path","currentParent","currentPath","name","rest","children","nextParent","find","child","push","buildHierarchy","fields","data","_ref","targetField","reduce","res","row","host","getValueByName","Fields","constructor","_indexCache","Map","getIndexByName","has","get","index","indexOf","set","extractYearsFromGroupedTimeMap","Object","keys","sort","processTimeMap","groupBy","dedupBy","orderBy","arguments","undefined","groupByIndex","dedupByIndex","orderByIndex","groupedData","result","groupKey","dedupKey","acc","key","values","a","b","renderContainer","content","document","createElement","setAttribute","divBtn","sequence","chart","appendChild","style","display","arc","d3","startAngle","d","x0","endAngle","x1","innerRadius","Math","sqrt","y0","outerRadius","y1","colors","scaleOrdinal","schemePaired","createVisualization","element","vis","radius","baseURL","currentYear","partition","size","PI","root","hierarchy","sum","value","nodes","descendants","sequenceEl","querySelector","selectAll","enter","append","attr","currentUrl","on","touchStart","depth","mouseover","select","mouseleave","e","preventDefault","stopPropagation","anc","ancestors","url","map","node","concat","sequenceArray","shift","updateBreadcrumbs","filter","innerHTML","transition","nodeArray","text","decodeURIComponent","renderYearButton","year","btn","className","id","textContent","getYearByBtn","getButtonByYear","container","ownerDocument","getElementById","renderYearButtons","allYears","onYearSelect","onclick","evt","target","forEach","RadialTree","cdxData","options","urlsByYear","years","selectYear","selectedBtn","classList","remove","add","renderChart","width","offsetWidth","height","urls"],"mappings":"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"}