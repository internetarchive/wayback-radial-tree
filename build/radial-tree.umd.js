!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","d3","lodash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).wb={},e.d3,e._)}(this,(function(e,t,n){"use strict";function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a=r(t);class c{constructor(e){this.fields=e[0],this.getIndexByName=n.memoize(this.getIndexByName)}getIndexByName(e){return this.fields.indexOf(e)}getValueByName(e,t){return e[this.getIndexByName(t)]}}const o=a.arc().startAngle((e=>e.x0)).endAngle((e=>e.x1)).innerRadius((e=>Math.sqrt(e.y0))).outerRadius((e=>Math.sqrt(e.y1))),s=a.scaleOrdinal(a.schemePaired);function i(e,t,n,r,c,i){const l=a.partition().size([2*Math.PI,n*n])(a.hierarchy({children:[i]}).sum((e=>!e.children)).sort(((e,t)=>t.value-e.value))).descendants(),d=e.querySelector(".sequence");function u(e){const t=e.ancestors().reverse();let n="";for(let e=1;e<t.length&&"end"!==t[e].data.name;e++)n=n+"/"+t[e].data.name;return`${r}/web/${c}0630${n}`}function p(e,n){const r=n.ancestors().reverse();r.shift();const c=u(n);!function(e,t){let n="";const r=document.createElement("span");r.setAttribute("class","symb"),r.innerHTML="/";for(let t=0;t<e.length;t++)n=0===t?" "+e[t].data.name:n+r.innerHTML+e[t].data.name;n=decodeURIComponent(n),d.innerHTML=`<a href="${t}">${n}</a>`}(r,c),a.selectAll("path").style("opacity",.3),t.selectAll("path").filter((e=>r.indexOf(e)>=0)).style("opacity",1)}t.selectAll("path").data(l).enter().append("a").attr("xlink:href",u).on("touchstart",(function(e,t){return e.preventDefault(),e.stopPropagation(),p(),!1})).append("svg:path").attr("display",(e=>e.depth?null:"none")).attr("d",o).attr("fill-rule","evenodd").style("fill",(e=>s((e.children?e:e.parent).data.name))).style("opacity",1).style("cursor","pointer").on("mouseover",p),a.select("#d3_container").on("mouseleave",(function(){d.innerHTML="",a.selectAll("path").on("mouseover",null),a.selectAll("path").transition().style("opacity",1).on("end",(function(){a.select(this).on("mouseover",p)}))}))}function l(e,t,n){const r=e.querySelector(".div-btn");r.onclick=e=>n(e.target.id),e.querySelector(".year-btn")||t.forEach((e=>r.appendChild(function(e){const t=document.createElement("button");return t.className="year-btn",t.id=e,t.textContent=e,t}(e))))}e.RadialTree=function(e,t){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).baseURL||"https://web.archive.org",r=function(){const e=document.createElement("div");e.setAttribute("class","rt-content");const t=document.createElement("div");t.setAttribute("class","div-btn");const n=document.createElement("p");n.setAttribute("class","sequence");const r=document.createElement("div");return r.setAttribute("id","chart"),e.appendChild(t),e.appendChild(n),e.appendChild(r),e.style.display="block",e}();e.appendChild(r);const o=new c(t),s=function(e){let{groupBy:t,dedupBy:n,orderBy:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return e;const a=new c(e),o=a.getIndexByName(t),s=a.getIndexByName(n),i=a.getIndexByName(r),l=e.slice(1).reduce(((e,t)=>{const n=t[o],r=t[s];return e[n]||(e[n]={}),e[n][r]||(e[n][r]=t),e}),{});return Object.keys(l).reduce(((e,t)=>{const n=Object.values(l[t]);return n.sort(((e,t)=>{const n=e[i],r=t[i];return n<r?-1:n>r?1:0})),e[t]=n,e}),{})}(t,{groupBy:"timestamp:4",dedupBy:"urlkey",orderBy:"urlkey"}),d=(u=s)?Object.keys(u).sort():u;var u;function p(t){e.querySelector(".active-btn")&&e.querySelector(".active-btn").classList.remove("active-btn");const r=function(e,t){return e.ownerDocument.getElementById(t)}(e,t);r&&r.classList.add("active-btn"),function(e,t){e.querySelector(".sequence").innerHTML="",e.querySelector("#chart").innerHTML="";const r=e.querySelector("#chart").offsetWidth,c=r,l=r/2,d=a.select("#chart").append("svg:svg").attr("width",r).attr("height",c).append("svg:g").attr("id","d3_container").attr("transform","translate("+r/2+","+c/2+")");d.append("svg:circle").attr("r",l).style("opacity",0);const u=s[t],p=function(e,t,n){let{targetField:r}=n;return t.reduce(((t,n)=>{const a=e.getValueByName(n,r),[c,...o]=a.split("/");var s;return t.name=(s=c)?s.slice(0,s.length-1).split(",").reverse().join("."):s,function(e,t){if(!t||0===t.length)return;let n=e,r=t;for(;r.length>0;){const[e,...t]=r;if(!e)return;n.children||(n.children=[]);let a=n.children.find((t=>t.name===e));a||(a={name:e},n.children.push(a)),n=a,r=t}}(t,o),t}),{})}(o,u,{targetField:"urlkey"});i(e,d,l,n,t,p)}(e,t)}l(e,d,p),p(d[d.length-2]||d[0])}}));
//# sourceMappingURL=radial-tree.umd.js.map
